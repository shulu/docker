{% extends 'LycheeAdminBundle:UGSV:layout.html.twig' %}
{% import 'LycheeAdminBundle::helper.html.twig' as helper %}

{% block body %}
    <button type="button" class="btn btn-primary pull-left" data-toggle="modal" data-target="#create_whitelist">
        <span class="glyphicon glyphicon-plus"></span>
    </button>
    <div class="clearfix">
        <div class="col-lg-4 pull-right">
            <form>
                <div class="input-group">
                    <input type="text" name="query" class="form-control" placeholder="用户id、昵称" value="{{ query|default('') }}">
                <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit">搜索</button>
                </span>
                </div><!-- /input-group -->
            </form>
        </div><!-- /.col-lg-6 -->
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>用户ID</th>
                    <th>昵称</th>
                    <th>头像</th>
                    <th>粉丝数</th>
                    <th>最后发帖时间</th>
                    <th>帖子数</th>
                    <th>短视频数</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
            {% for item in items %}

                    <tr id="item_{{ item.userId }}" class="item-tr" data-id="{{ item.userId }}">
                        <td>{{ item.userId }}</td>
                        <td>{{ item.nickname }}</td>
                        <td>
                            <img src="{{ item.avatarUrl|default(item.avatarUrl)|resizeImage(0, 50) }}" alt="topic-{{ item.userId }}" class="topic-img"/>
                        </td>
                        <td>{{ item.fansCount }}</td>
                        <td>{{ item.lastPostTime }}</td>
                        <td>{{ item.postCount }}</td>
                        <td>{{ item.svCount }}</td>
                        <td>
                            <button class="btn btn-danger delete-item" data-item-id="{{ item.userId  }}">
                                <span class="glyphicon glyphicon-trash"></span>
                            </button>
                        </td>
                    </tr>

            {% endfor %}
            </tbody>
        </table>
    </div>

    {% import 'LycheeAdminBundle::helper.html.twig' as helper %}
    {% if paginator is not null %}
    {{ helper.newpage(paginator, app.request.get('_route'), query) }}
    {% endif %}

<!-- Modal -->
<div class="modal fade" id="create_whitelist" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">添加短视频白名单用户</h4>
            </div>
            <form role="form" method="post" action="{{ path('lychee_admin_ugsv_createwhitelist') }}" enctype="multipart/form-data" >
                <div class="modal-body">
                    <div class="form-group">
                        <label for="whitelist_area">用户id（使用回车分割，单次最多100个）</label>
                        <textarea  class="form-control" id="whitelist_area" style="height:500px;" name="ids"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="create_white_list_btn" >确 定</button>
                </div>
            </form>
        </div>
    </div>
</div>


{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>

        $(document).ready(function () {

            $createModal = $("#create_whitelist");
            $input = $("#whitelist_area");

            $createModal.on('hidden.bs.modal', function (e) {
                $createModal.find('form').find('input[name]').val('');
            });

            $(".delete-item").click(function () {
                if (confirm("确认删除？")) {
                    var id = $(this).data("item-id");
                    $.post("{{ path('lychee_admin_ugsv_removewhitelist') }}", {
                        id: id
                    }, function() {
                        $('#item_' + id).remove();
                    }, 'json');
                }

                return false;
            });

            $('#create_white_list_btn').click(function(){
                if ($.trim($input.val()).length==0) {
                    alert('请输入用户id');
                    return false;
                }
            });

        });
    </script>
{% endblock %}