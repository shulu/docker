{% extends 'LycheeAdminBundle:PostManager:layout.html.twig' %}

{% block body %}
    <button type="button" class="btn btn-primary pull-left" data-toggle="modal" data-target="#create_tag" style="margin-bottom: 20px;">
        <span class="glyphicon glyphicon-plus"></span>
    </button>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th>ID</th>
                <th>名称</th>
                <th>创建者</th>
                <th>创建时间</th>
                <th>帖子数</th>
                <th><span class="glyphicon glyphicon-wrench"></span></th>
            </tr>
            </thead>
            <tbody>
            {% for tag in tags %}
                <tr>
                    <td>{{ tag.id }}</td>
                    <td>{{ tag.name }}</td>
                    <td>{{ creators[tag.creatorId].email }}</td>
                    <td>{{ tag.createTime|date('Y-m-d H:i') }}</td>
                    <td>{{ tag.postCount }}</td>
                    <td>
                        <a class="btn btn-info" data-id="{{ tag.id }}"
                           href="{{ path('lychee_admin_contentmanagement_postsintag', {tagId: tag.id}) }}">
                            <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>
                        </a>
                        <button class="btn btn-default edit-tag" data-id="{{ tag.id }}" data-name="{{ tag.name }}">
                            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                        </button>
                        <button class="btn btn-danger remove-tag" data-id="{{ tag.id }}">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </button>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="create_tag" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">创建标签</h4>
                </div>
                <form role="form" method="post" action="{{ path('lychee_admin_contentmanagement_createposttag') }}">
                    <input type="hidden" name="tag_id" id="tag_id">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="tag_name">名称</label>
                            <input type="text" class="form-control" id="tag_name" name="name" placeholder="不能与现有的重复">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">确 定</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function() {
            var $tagForm = $('#create_tag');
            var $tagId = $('#tag_id');
            var $tagName = $('#tag_name');

            $tagForm.on('hidden.bs.modal', function () {
                $tagId.val('');
                $tagName.val('');
            });
            $('.remove-tag').click(function() {
                if (confirm('确定删除？')) {
                    var $form = $('<form method="post"></form>');
                    $form.attr('action', '{{ path("lychee_admin_contentmanagement_removeposttag") }}');
                    $form.append('<input type="hidden" name="id" value="' + $(this).data('id') + '">');
                    $('body').append($form);
                    $form.submit();
                }

                return false;
            });
            $('.edit-tag').click(function() {
                var tagId = $(this).data('id');
                var tagName = $(this).data('name');
                $tagForm.modal('show');
                $tagId.val(tagId);
                $tagName.val(tagName);

                return false;
            });
        });
    </script>
{% endblock %}