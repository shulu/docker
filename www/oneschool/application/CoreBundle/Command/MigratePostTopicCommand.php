<?php
namespace Lychee\Bundle\CoreBundle\Command;

use Symfony\Bundle\FrameworkBundle\Command\ContainerAwareCommand;
use Lychee\Bundle\CoreBundle\ModuleAwareTrait;
use Symfony\Component\Console\Input\InputArgument;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;

class MigratePostTopicCommand extends ContainerAwareCommand {
    use ModuleAwareTrait;

    protected function configure() {
        $this
            ->setName('lychee:migration:post-topic')
            ->setDefinition(array())
            ->setDescription('Migrate some posts\'s topic id.')
            ->setHelp(<<<EOT
This command will migrate some posts topic id.

EOT
            )
        ;
    }

    protected function initialize(InputInterface $input, OutputInterface $output) {
        parent::initialize($input, $output);
    }

    protected function execute(InputInterface $input, OutputInterface $output) {
        $postService = $this->post();
        $postsToMigrate = $this->getPostsToMigrate();
        foreach ($postsToMigrate as $topicId => $postIds) {
            foreach ($postIds as $postId) {
                $post = $postService->fetchOne($postId);
                if ($post == null) {
                    continue;
                }
                $postService->updateTopic($postId, $topicId);
            }
        }
    }

    private function getPostsToMigrate() {
        return array(
            25158 => array(
                40619148528641, 40582293209089, 40402888089601, 40576033948673, 40584636510209, 40462432328705,
                40505598588929, 40479408056321, 40483764802561, 40534428483585, 40397368611841, 40556951705601,
                40579460311041, 40483212542977, 40520198456321, 40583815149569, 40468209108993, 40565946232833,
                40557710854145, 40476141072385, 40374521707521, 40358073428993, 40471584327681, 39896422387713,
                40070427243521, 40088857180161, 39922573559809, 40039347617793, 40107438331905, 39853889798145,
                39937292527617, 39846521277441, 40032101729281, 39847647043585, 39863118428161, 39911100142593,
                39921017180161, 40277996244993, 39883004771329, 40034140182529, 39895506493441, 40175135631361,
                40135758557185, 40129473345537, 40140581047297, 40479408056321, 40307450202113, 40294293497857,
                40034694711297, 39891392901121, 40397368611841, 40910981452801, 40545593091073, 40489050470401,
                40493820983297, 40562886639617, 40394671223809, 40538524327937, 40546016605185, 40122092936193,
                40477598185473, 40132387379201, 40304190198785, 40494101805057, 40014475842561, 40450893971457,
                40540981619713, 40547859476481, 40239433552897, 40224757537793, 39858814721025, 40223729217537,
                40125634627585, 40337665664001, 39933884111873, 39933081099265, 39948201042945, 39939395985409,
                39935800356865, 39943297202177, 39943297202177, 40072008403969, 39946244590593, 39916000016385,
                39859719367681, 39897627292673, 39908427364353, 40130482038785, 40091797387265, 40114669540353,
                39923853240321, 40184090516481, 40208632038401, 40220587674625, 40215199887361, 40366301121537,
                40304058277889, 40453081167873, 40398126530561, 40403692206081, 40353506846721, 59517288360961,
                59505903449089, 59857925621761, 59782435134465, 59596055907329, 59507616181249, 59508647339009,
                59657835022337, 59659953271809, 59625646458881, 59508242509825, 59480332260353, 59506645983233,
                59506667415553, 59513623994369, 59657835022337, 59603450599425, 59505903449089, 59521023662081),
            31174 => array(
                12485266598913, 13637420297217, 15468525250561, 20082062115841, 23800421590017, 21062890555393,
                25821902340097, 28256914964481, 28256914964481, 34034297302017, 34584565884929, 34678197516289,
                36671816941569, 38842087993345, 39751168314369)
        );
    }
}