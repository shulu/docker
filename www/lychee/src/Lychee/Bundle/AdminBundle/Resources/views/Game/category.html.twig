{% extends 'LycheeAdminBundle:Game:layout.html.twig' %}
{% block body %}
    <button type="button" id="create_category_btn" class="btn btn-primary" data-toggle="modal"
            data-target="#create_category_form">
        <span class="glyphicon glyphicon-plus"></span>
    </button>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th>分类名称</th>
                <th>Icon</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            {% if categories | length > 0 %}
                {% for category in categories %}
                    <tr>
                        <td>{{ category.name }}</td>
                        <td><img src="{{ category.icon }}" alt="{{ category.name }}" width="44px"/></td>
                        <td>
                            <a href="{{ path('lychee_admin_game_categorydetail', {id: category.id}) }}" class="btn btn-default edit-category" title="修改分类名字">
                                <span class="glyphicon glyphicon-edit"></span>
                            </a>
                            <button class="btn btn-danger delete-category"
                                    data-category-id="{{ category.id }}">
                                <span class="glyphicon glyphicon-trash"></span>
                            </button>
                        </td>
                    </tr>
                {% endfor %}
            {% endif %}
            </tbody>
        </table>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="create_category_form" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">添加{{ subTitle }}</h4>
                </div>
                <form role="form" method="post" action="{{ path('lychee_admin_game_addcategory') }}"
                      enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="category_name">分类名称(不多于20字)</label>
                            <input type="text" name="category_name" id="category_name" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="icon">游戏图标</label>
                            <input type="file" class="form-control icon" name="icon" id="icon">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">保 存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    {% stylesheets '@fileinput_css' filter="cssrewrite" %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
    <style>
        .nav-tabs { margin-bottom: 10px; }
    </style>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {% javascripts '@fileinput_js' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <script type="application/javascript">
        $(document).ready(function () {
            var fileinputConfig = {
                allowedFileTypes: ['image'],
                showUpload: false
            };
            $(".icon").fileinput(fileinputConfig);
            $("button[type=submit]").click(function () {
                var categoryName = $('#category_name').val();
                if (categoryName.length > 20) {
                    alert("分类名称不能多于20个字")
                    return false;
                }
                if (!categoryName) {
                    alert("分类名字不能为空");
                    return false;
                }
                if (!$("#icon").val()) {
                    alert("请上传图标");
                    return false;
                }
            });
            $(".delete-category").click(function () {
                if (confirm("确认删除？")) {
                    var $form = $('<form></form>');
                    $form.attr("action", "{{ path('lychee_admin_game_deletecategory') }}");
                    $form.attr("method", "post");
                    $form.append('<input type="hidden", name="category_id" value="' + $(this).data('category-id') + '">');
                    $("body").append($form);
                    $form.submit();
                }

                return false;
            });

        });
    </script>
{% endblock %}
