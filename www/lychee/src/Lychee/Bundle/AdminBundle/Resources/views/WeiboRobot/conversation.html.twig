{% extends 'LycheeAdminBundle:WeiboRobot:layout.html.twig' %}

{% block body %}
    <button type="button" class="btn btn-primary pull-left" data-toggle="modal" data-target="#create_conversation">
        <span class="glyphicon glyphicon-plus"></span>
    </button>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>顺序</th>
                <th>内容</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for c in conversations %}
                <tr>
                    <td id="order_{{ c.id }}">{{ c.order }}</td>
                    <td id="content_{{ c.id }}">{{ c.content }}</td>
                    <td>
                        <button class="btn btn-default conversation-edit" data-id="{{ c.id }}">编辑</button>
                        <button class="btn btn-danger conversation-delete" data-id="{{ c.id }}">删除</button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- Modal -->
    <div class="modal fade" id="create_conversation" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">添加/编辑对话</h4>
                </div>
                <form role="form" method="post" action="{{ path('lychee_admin_weiborobot_setconversation') }}">
                    <input type="hidden" name="conversation_id" id="conversation_id">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="order">对话顺序</label>
                            <input type="text" name="order" id="order" class="form-control" placeholder="数字，如：1, 2, 3......">
                        </div>
                        <div class="form-group">
                            <label for="content">对话</label>
                            <input type="text" name="content" id="content" class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">保 存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function() {
            var $conversationModal = $('#create_conversation');
            $('.conversation-edit').click(function() {
                var conversationId = $(this).data('id');
                $('#conversation_id').val(conversationId);
                $('#order').val($('#order_' + conversationId).text());
                $('#content').val($('#content_' + conversationId).text());
                $conversationModal.modal('show');

                return false;
            });
            $conversationModal.on('hide.bs.modal', function() {
                $('#conversation_id').val('');
                $('#order').val('');
                $('#content').val('');
            });
            $('.conversation-delete').click(function() {
                var conversationId = $(this).data('id');
                if (confirm('确定删除？')) {
                    var $form = $('<form method="post"></form>');
                    $form.attr('action', '{{ path('lychee_admin_weiborobot_removeconversation') }}');
                    $form.append('<input type="hidden" name="id" value="' + conversationId + '">');
                    $('body').append($form);
                    $form.submit();
                }

                return false;
            });
        });
    </script>
{% endblock %}