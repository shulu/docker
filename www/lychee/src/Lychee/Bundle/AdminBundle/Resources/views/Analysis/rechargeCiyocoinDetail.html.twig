{% extends 'LycheeAdminBundle:Analysis:layout.html.twig' %}
{% import 'LycheeAdminBundle::helper.html.twig' as helper %}
{% block body %}
    <div class="pull-right date-search">
        <form class="form-inline">
            <div class="form-group">
                <div class="col-sm-1">
                    <button type="button" class="btn btn-primary form-control" id="export">导 出</button>
                </div>
                <div class="col-sm-4">
                    <div class="input-group">
                        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                        <input type="text" name="startDate" id="startDate" class="form-control datepicker" value="{{ startDate }}">
                    </div>
                </div>
                <div class="col-sm-1">
                    <div class="form-control data-arrow"><span class="glyphicon glyphicon-arrow-right"></span></div>
                </div>
                <div class="col-sm-4">
                    <div class="input-group">
                        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                        <input type="text" name="endDate" id="endDate" class="form-control datepicker" value="{{ endDate }}">
                    </div>
                </div>
                <div class="col-sm-1">
                    <button type="submit" class="btn btn-default">查 询</button>
                </div>
            </div>
        </form>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <td>用户名</td>
                    <th>充值时间</th>
                    <th>充值金额</th>
                    <th>充值次元币</th>
                    <th>订单号</th>
                    <th>平台</th>
                    <th>支付渠道</th>
                </tr>
            </thead>
            <tbody>
            {% if items | length > 0 %}
                {% for item in items %}
                    <tr>
                        {% if userNames | length > 0 and userNames[item.payer] is defined %}
                            <td><a href="{{ path('lychee_admin_contentaudit_userdetail', {'userId': item.payer}) }}">{{ userNames[item.payer] }}</a></td>
                        {% else %}
                            <td></td>
                        {% endif %}
                        <td>{{ item.purchase_time }}</td>
                        <td>{{ item.total_fee }}</td>
                        <td>{{ item.ciyo_coin }}</td>
                        <td>{{ item.transaction_id ? item.transaction_id : item.appstore_transaction_id}}</td>
                        <td>{{ item.transaction_id ? '安卓' : '苹果' }}</td>
                        <td>{{ item.pay_type =='wechat' ? "微信" : item.pay_type =='alipay' ? "支付宝" : item.pay_type == "qpay" ? "QQ支付" : "苹果商店"}}</td>
                    </tr>
                {% endfor %}
            {% endif %}
            </tbody>
        </table>
    </div>
    <nav>
        <ul class="pagination">
            <li>
                <a href="{{ path('lychee_admin_analysis_rechargeciyocoindetail', {startDate: startDate, endDate: endDate, page: 1}) }}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% if pageCount < 1 %}{% set pageCount = 1 %}{% endif %}
            {% for p in 1..min(10, pageCount) %}
                <li class="{{ p==page? 'active' }}">
                    <a href="{{ path('lychee_admin_analysis_rechargeciyocoindetail', {startDate: startDate, endDate: endDate, page: p}) }}">{{ p }}</a>
                </li>
            {% endfor %}
            <li>
                <a href="{{ path('lychee_admin_analysis_rechargeciyocoindetail', {startDate: startDate, endDate:endDate, page: pageCount}) }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets '@LycheeAdminBundle/Resources/public/datepicker/datepicker3.css' %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts '@LycheeAdminBundle/Resources/public/datepicker/bootstrap-datepicker.js' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    {% javascripts '@LycheeAdminBundle/Resources/public/datepicker/locales/bootstrap-datepicker.zh-CN.js' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <script>
        $(document).ready(function() {
            var dd = new Date();

            dd.setDate(dd.getDate() + 1);
            $(".datepicker").datepicker({
                format: "yyyy-mm-dd",
                language: "zh-CN",
                todayHighlight: true,
                endDate: dd
            });

            $('#export').click(function () {
                var start = $('#startDate').val();
                var end = $('#endDate').val();
                var $form = $('<form></form>');
                $form.attr('method', 'post').attr('action', "{{ path('lychee_admin_analysis_exportrechargeciyocoindetailcsv') }}")
                        .attr('target', '_blank');
                $form.append('<input type="hidden" name="start_date" value="' + start + '">');
                $form.append('<input type="hidden" name="end_date" value="' + end + '">');
                $(document.body).append($form);
                $form.submit();
            })
        });
    </script>
{% endblock %}