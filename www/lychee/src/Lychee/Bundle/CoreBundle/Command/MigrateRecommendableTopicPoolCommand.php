<?php
namespace Lychee\Bundle\CoreBundle\Command;

use Symfony\Bundle\FrameworkBundle\Command\ContainerAwareCommand;
use Lychee\Bundle\CoreBundle\ModuleAwareTrait;
use Symfony\Component\Console\Input\InputArgument;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;

class MigrateRecommendableTopicPoolCommand extends ContainerAwareCommand {
    use ModuleAwareTrait;

    protected function configure() {
        $this
            ->setName('lychee:migration:recommendable-topic-pool')
            ->setDefinition(array())
            ->setDescription('fill the recommendable topic pool')
            ->setHelp(<<<EOT
This command will fill the recommendable topic pool.

EOT
            );
    }

    protected function execute(InputInterface $input, OutputInterface $output) {
        $topicIds = array(
            25076, 25073, 25511, 25362, 26351, 25158, 27925, 28711, 28447, 25617,
            26847, 28420, 25116, 25339, 25247, 25169, 25361, 29520, 29661, 27557,
            25168, 25109, 25150, 25098, 25497, 26504, 25354, 25159, 25079, 25115,
            25097, 29579, 27531, 25386, 25176, 25077, 26443, 25420, 32129, 27230,
            25085, 25237, 28960, 28874, 25186, 25385, 25087, 25384, 25069, 25126,
            26760, 31747, 31825, 40333, 25093, 25342, 25074, 25166, 25117, 33778,
            25078, 27115, 25123, 25265, 25080, 25211, 31168, 25811, 34016, 25171,
            35409, 32872, 36094, 30727, 25735, 25220, 27737, 25083, 25412, 25531,
            25217, 28154, 30653, 25463, 25120, 35437, 28510, 25590, 31167, 47555,
            25337, 47472, 31893, 25633, 28858, 32636, 25072, 25433, 25559, 25091,
            34708, 26204, 25430, 26477, 29759, 28505, 25468, 29632, 25215, 33034,
            25128, 25101, 25216, 25850, 29588, 30202, 25457, 29604, 26509, 26012,
            26623, 33128, 43925, 25075, 25327, 43011, 25348, 33787, 25841, 25423,
            25086, 31884, 28625, 25435, 26033, 37184, 26712, 25611, 28801, 33799,
            29437, 41951, 25923, 25978, 42104, 26145, 32774, 25475, 25365, 25222,
            25118, 25473, 30373, 47820, 34753, 35321, 35024, 25121, 28823, 45080,
            34316, 31036, 42558, 29624, 39539, 28827, 25328, 39791, 35089, 30725,
            43976, 32908, 34901, 36933, 37485, 34156, 26454, 32095, 31348, 40964,
            26082, 30364, 35360, 26617, 25762, 31335, 32751, 30349, 43123, 32402,
            41370, 26171, 31279, 37426, 25146, 33894, 26081, 27480, 39891, 32021,
            45037, 36919, 26372, 30965, 26600, 39703, 37395, 25533, 34971, 25820,
            26428, 25719, 32946, 31299, 31252, 32504, 37099, 46989, 48002, 25188,
            40615, 38644, 42503, 25453, 29776, 26554, 31865, 33908, 41068, 35057,
            31624, 28495, 25379, 40387, 40508, 31481, 25869, 26634, 32787, 25598,
            32594, 25583, 36401, 32878, 47384, 25373, 29583, 25536, 46853, 38824,
            26091, 44368, 25161, 27837, 31000, 32433, 25366, 37664, 35013, 34149,
            26446, 31149, 44680, 44993, 30592, 35601, 47458, 47599, 32407, 26706,
            30257, 40415, 25364, 32463, 25546, 37275, 25229, 31560, 46884, 32393,
            33348, 32352, 25912, 26895, 32065, 44997, 42748, 47256, 28222, 44994,
            38610, 27217, 45009, 27579, 25183, 45003, 45010, 42076, 47522, 39024,
            39112, 25883, 25147, 25500, 35909, 44317, 29619, 39328, 29703, 45004,
            35082, 47830, 25956, 32108, 32232, 44990, 47198, 44939, 25699, 45011,
            44989, 44998, 27477, 33840, 44987, 47665, 45007, 28114, 35294, 45006,
            45015, 47938, 40043, 47019, 25746, 31449, 44925, 47550, 43166, 44074,
            41582, 47119, 40259, 26731, 45016, 25099, 27517, 44999, 45008, 30436,
            42883, 44996, 45019, 41865, 38171, 29129, 32062, 44802, 27518, 43796,
            32258, 44608, 47001, 28890, 45005, 47183, 25517, 44988, 40929, 45182,
            47013, 47628, 45014, 46953, 47867, 48001, 30334, 38710, 42639, 44738,
            44995, 36147, 46843, 29777, 37237, 42089, 45002, 44338, 46767, 38344,
            40502, 45073, 37238, 38362, 44734, 45128, 47005, 47453, 45001, 46903,
            34827, 40503, 43576, 45022, 43043, 39097, 44945, 46761, 46965, 47016,
            40354, 40793, 42648, 45176, 45216, 45253, 40541, 40726, 43893, 45078,
            46204, 47575, 47694, 47926, 46195, 47776, 40556, 46787, 47125, 47443,
            35422, 45012, 46758, 26334, 33970, 38675, 45024, 45137, 47636, 47997,
            36267, 36391, 44869, 45055, 47038, 47139, 47601, 44969, 47274, 47832,
            47902, 47917, 48019, 29792, 35716, 36930, 44853, 46948, 47511, 47602,
            30253, 31914, 32536, 44918, 46828, 46935, 47466, 48064, 31429, 34837,
            45020, 45169, 46850, 36332, 45051, 46783, 26245, 29849, 30945, 42555,
            45018, 47257, 47291, 48146, 44921, 47029, 47421, 47743, 47755, 25572,
            28897, 40634, 46715, 46930, 46931, 47454, 48133, 37258, 38935, 40299,
            45017, 46770, 46800, 47003, 47065, 47178, 47298, 47539, 29811, 29861,
            42345, 44395, 44977, 46791, 46835, 46869, 46898, 46901, 46979, 47078,
            47211, 47285, 47385, 47478, 47645, 47648, 47948, 48101, 30386, 31586,
            36378, 43018, 46975, 47152, 47228, 47282, 47391, 47470, 47546, 47767,
            47812, 47929, 48083, 29862, 44401, 45023, 46765, 46805, 46862, 46880,
            46982, 47031, 47081, 47137, 47144, 47195, 47199, 47240, 47330, 47347,
            47483, 47506, 47699, 47803, 47833, 47839, 47848, 47873, 47912, 48011,
            48069, 48137, 48174, 29796, 29797, 29814, 29833, 29839, 29863, 42393,
            44610, 46816, 46819, 46879, 46896, 46945, 47131, 47204, 47265, 47297,
            47320, 47461, 47467, 47532, 47568, 47622, 47652, 47734, 47747, 47819,
            47828, 47831, 47842, 47864, 47889, 47920, 47936, 47959, 47961, 47978,
            47992, 48024, 48039, 48045, 48084, 48113, 48132, 48163, 48182, 29801,
            29805, 29812, 29846, 29854, 29860, 29874
        );

        $em = $this->container()->get('doctrine')->getManager();
        $sql = 'SELECT r.target_id FROM recommendation_item r LEFT JOIN topic t ON r.target_id = t.id WHERE r.type = \'topic\' AND t.title is not null';
        $stat = $em->getConnection()->executeQuery($sql);
        $rows = $stat->fetchAll(\PDO::FETCH_ASSOC);
        $recommendedTopicIds = array_map(function($r){return $r['target_id'];}, $rows);

        $service = $this->recommendation();
        $service->addRecommendableTopics($topicIds);
        $service->addRecommendableTopics($recommendedTopicIds);
    }
}