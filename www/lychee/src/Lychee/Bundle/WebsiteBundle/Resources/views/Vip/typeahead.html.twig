<script type="text/javascript">
    (function(){
        var suggestions = [];
        var engine = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.whitespace,
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            identify: function (obj) {
                return obj.id;
            },
            remote: {
                url: "/topic/keyword/search",
                prepare: function(query, settings) {
                    settings.url += "?keyword=" + encodeURIComponent(query);
                    return settings;
                },
                transform: function (response) {
                    suggestions = response;
                    var data = [];
                    for (var index in response) {
                        data.push(response[index].name);
                    }
                    return data;
                }
            }
        });

        var $topic = $("#topic");
        $topic.typeahead({
            minLength: 1,
            highlight: true,
            hint: false
        }, {
            source: engine,
            limit: 100
        });
        $topic.on([
            'typeahead:active',
            'typeahead:idle',
            'typeahead:open',
            'typeahead:close',
            'typeahead:change',
            'typeahead:render',
            'typeahead:select',
            'typeahead:autocomplete',
            'typeahead:cursorchange',
        ].join(' '));
        $topic.bind("typeahead:select", function(ev, suggestion) {
            console.log(ev);
            console.log(suggestion);
            for (var index in suggestions) {
                if (suggestions[index].name === suggestion) {
                    $("#topic_id").val(suggestions[index].id);
                }
            }
        });
    }());
</script>